# 电影购票系统

## 1. 整体要求
php开发规范将参照PEAR的规范，基本采用PEAR指定的规范，在其基础上增加、修改或删除部分适合具体开发环境的规范。本规范只针对PHP开发过程中编码的规范，对于PHP开发项目中文件、目录、数据库等方面的规范，将不重点涉及。
本规范包含了PHP开发时程序编码中命名规范、代码缩进规则、控制结构、函数调用、函数定义、注释、包含代码、PHP标记、文件头的注释块、CVS标记、URL样例、常量命名等方面的规则。

## 2. 安全规范

### 2.1 包含文件

#### 2.1.1 命名规则
提取出来具有通用函数的包含文件，文件后缀以.inc来命名，表明这是一个包含文件。
如果有多个.inc文件需要包含多页面，请把所有.inc文件封装在一个文件里面，具体到页面只需要包换一个.inc文件就可以了
如:xxx_session.inc
xxx_setting.inc
mysql_db.inc

把以上文件以一下方式，封装在xxx.basic.inc文件里面
require_once(”xxx_session.inc”);
require_once(”xxx_comm.inc”);
require_once(”xxx_setting.inc”);
require_once(”mysql_db.inc”);

注：是否需要封装到一个文件，视情况而定，如果每个inc的功能是分散到不同的页面使用的话，就不建议封装。

#### 2.1.2 存放规则
一般包含文件不需要直接暴露给用户，所以应该放在web server 访问不到的目录里，避免泄露设置信息。                                                              
### 2.2 一些针对PHP的规则
设置 register_globals = off (Y!PHP 已经禁止了register_globals，如果你使用Y!PHP可以不考虑这项设置)
设置 error_reporting = E_ALL (Y!PHP 的缺省设置），并且要修正所有的error和warning
将实际的操作放在被引用的文件中。把引用文件放到不可以被直接浏览的目录下

### 2.3 其它处理规则

#### 2.3.1 对输入参数值进行转义处理
页面接到参数需要SQL操作，这时候需要做转义，尤其需要注意”;”。
如：
```
$a = ” Let’s Go ” ;
$sql = “Insert into tmp(col) values(’$a’)” ;
//这种情况出现错误的不确定性。
```

#### 2.3.2 操作大HTML文本
很多时候需要存放一大段HTML文本供页面使用，象用户定制页头页脚等。
需要剔除脚本标记，避免执行恶意php代码。
转换”<"">“号，保证代码完整。

### 3. 编码规范

#### 3.1 命名规范
制定统一的命名规范对于项目开发来说非常重要，不但可以养成程序员一个良好的开发习惯，还能增加程序的可读性、可移植性和可重用性，还能很好的提高项目开发的效率。

#### 3.1.1 普通变量
普通变量命名遵循以下规则：
a． 所有字母都使用小写；
b． 对于一个变量使用多个单词的，使用’_'作为每个词的间隔。
例如：
```
$base_dir、$red_rose_price等
```
#### 3.1.2 静态变量
静态变量命名遵循以下规则：
a． 静态变量使用小写的s_开头；
b． 静态变量所有字母都使用小写；
c． 多个单词组成的变量名使用’_'作为每个词的间隔。
例子：
```
$s_base_dir、$s_red_rose_prise等。
```
#### 3.1.3 局部变量
局部变量命名遵循以下规则：
a． 所有字母使用小写；
b． 变量使用' _ '开头；
c． 多个单词组成的局部变量名使用' _ ' 作为每个词间的间隔,例如：
```
$_base_dir、$_red_rose_price等。
```

#### 3.1.4 全局变量
全局变量应该带前缀’g',知道一个变量的作用域是非常重要的。
例如
```
global $gLOG_LEVEL;
```
#### 3.1.5 全局变量
全局变量命名遵循以下规则：
a． 所有字母使用大写
b． 全局变量多个单词间使用’_'作为间隔。
例子：
```
$BASE_DIR、$RED_ROSE_PRICE等。
```
#### 3.1.6 session变量
session变量命名遵循以下规则：
a． 所有字母使用大写；
b． session变量名使用’S_’开头；
c． 多个单词间使用’_'间隔。

#### 3.1.7 类
php中类命名遵循以下规则：
a． 以大写字母开头；
b． 多个单词组成的变量名，单词之间不用间隔，各个单词首字母大写。
例子：

class MyClass 或class DbOracle等。

#### 3.1.8 方法或函数
方法或函数命名遵循以下规则：
a． 首字母小写；
b． 多个单词间不使用间隔，除第一个单词外，其他单词首字母大写。

#### 3.1.9 缩写词
当变量名或者其他命名中遇到缩写词时，参照具体的命名规则，而不采用缩写词原来的全部大写的方式。
例子：
function myPear（不是myPEAR） functio getHtmlSource（不是getHTMLSource）。

#### 3.1.10 数据库表名
数据库表名命名遵循以下规范：
a． 表名均使用小写字母；
b． 对于普通数据表，使用_t结尾；
c． 对于视图，使用_v结尾；
d． 对于多个单词组成的表名，使用_间隔；
例子：user_info_t 和 book_store_v等

#### 3.1.11 数据库字段
数据库字段命名遵循以下规范：
a． 全部使用小写；
b． 多个单词间使用_间隔。
例子：user_name、rose_price等。

### 3.2 书写规则
书写规则是指在编写php程序时，代码书写的规则，包括缩进、结构控制等方面规范：

#### 3.2.1 代码缩进
在书写代码的时候，我们规定代码缩进规则如下：
使用tab缩进,也可以说是4个空格
例子：
```
for ( $i=0;$i<$count;$i++ )
{
    echo "test";
}
```
#### 3.2.2 大括号{ }书写规则
在程序中进行结构控制代码编写，如if、for、while、switch等结构，大括号传统的有两种书写习惯，如下：
```
for($i=0;$i<$count;$i++)
{
    echo "test";
}
```
#### 3.2.3 if, else, swith, for, while等书写
对于控制结构的书写遵循以下规则：
a． 在if条件判断中，如果用到常量判断条件，将常量放在等号或不等号的左边，例如：
if ( 6 == $errorNum )，因为如果你在等式中漏了一个等号，语法检查器会为你报错，可以很快找到错误位置，这样的写法要多注意；
b． switch结构中必须要有default块；
c． 在for和wiile的循环使用中，要警惕continue、break的使用，避免产生类似goto的问题；

#### 3.2.4 语句断行, 每行控制在80个字符以内
在代码书写中，遵循以下原则：
a． 尽量保证程序语句一行就是一句，而不要让一行语句太长产生折行；
b． 尽量不要使一行的代码太长，一般控制在80个字符以内；
c． 对于执行数据库的sql语句操作，尽量不要在函数内写sql语句，而先用变量定义sql语句，然后在执行操作的函数中调用定义的变量；
例子：
```
$sql = "SELECT username,password,address,age,postcode FROM test_t ";
$sql .= " WHERE username='aaa'";
$res = mysql_query($sql);
```
### 3.3 程序注释
每个程序均必须提供必要的注释，书写注释要求规范，为今后利用phpdoc生成php文档做准备,例如：
a． 注释中除了文件头的注释块外，其他地方使用//注释和/* */的注释；
b． 注释内容必须写在被注释对象的前面，不写在一行或者后面；

#### 3.3.1 变量或者语句注释
程序中变量或者语句的注释遵循以下原则：
a． 写在变量或者语句的前面一行，而不写在同行或者后面；
b． 注释采用//或者/* */的方式；
c． 每个函数前面要包含一个注释块。内容包括函数功能简述，输入/输出参数，预期的返回值，出错代码定义。
d． 注释完整规范。
e． 把已经注释掉的代码删除，或者注明这些已经注释掉的代码仍然保留在源码中的特殊原因。
